<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>个人照片</title>
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
    <link href="packages/mui@3.4.0/dist/css/mui.min.css" rel="stylesheet"/>
    <!--App自定义的css-->
    <link href="css/app.css?ver=16.12.376" rel="stylesheet"/>
    <style type="text/css">
        input[type=text] {
            padding: 5px;
            border: 0;
            margin-bottom: 0;
        }

        .slide-container {
            background: #ffffff;
            border: 2px dotted #fd8b14;
            border-radius: 6px;
            width: 100%;
            height: 250px;
            text-align: center;
            position: relative;
        }

        .slide-container .demo, .photo {
            width: 230px;
            height: 100%;
            border-radius: 6px;
            padding-top: 10px;
            padding-bottom: 10px;
        }

        .camera-container {
            left: 0;
            right: 0;
            top: 50px;
            text-align: center;
            position: absolute;
        }

        .camera {
            width: 150px;
            height: 150px;
            display: inline-block;
            font-size: 0;
            line-height: 0;
        }

        .camera .input-upload-image {
            width: 150px;
            height: 150px;
            z-index: 888;
        }

        .input-upload-image {
            z-index: 1;
            border: none;
            -webkit-opacity: 0;
            opacity: 0;
        }

        .camera img {
            width: 150px;
            height: 150px;
            z-index: 999;
            margin-top: -150px;
        }
    </style>
</head>
<body style="background-color:#f7f7f7">
<div class="mui-content" style="background-color:#f7f7f7">
    <div style="margin:0;padding:0">
        <div style="margin-top:20px">
            <img src="images/apply3.png" style="width:100%">
        </div>
        <div style="text-align:center;margin-top:40px;color:#646464">
            请上传<span style="color:#fb9329" id="lbTitle">本人手持身份证照片</span>
        </div>
        <div style="height:10px">
        </div>
    </div>
    <div style="padding-left:20px;padding-right:20px">
        <div style="background-color:#ffffff">
            <div class="slide-container">
                <img id="img1-0" class="demo" src="images/demo4.png">
                <img id="img1-1" class="photo" src="images/demo3.png" style="display:none">
                <div id="div1-0" class="camera-container">
                    <div class="camera">
                        <input type="file" accept="image/*" id="img1" name="img1"
                               class="input-upload-image"/>
                        <img src="images/camera.png"/>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div style="padding-left:20px;padding-right:20px;margin-top:30px">
        <button class="btnActive"
                style="background:#ff8c14;border-radius:44px;height:44px;color:#ffffff;font-size:18px;width:100%;border:none"
                onclick="apply()">下一步
        </button>
    </div>
    <div class="msg-post" style="z-index:2">
        <table style='width:100%;height:100%'>
            <tr>
                <td style='vertical-align:middle'>
                    <div>
                        <img src="images/loading.gif" style="width:auto;height:40px">
                    </div>
                    <div style="font-size:16px">
                        提交中，请等待...
                    </div>
                </td>
            </tr>
        </table>
    </div>
    <div style="height:30px"></div>
</div>
</body>
</html>
<script src="packages/jquery@3.1.1/dist/jquery.min.js"></script>
<script src="packages/mui@3.4.0/dist/js/mui.min.js"></script>
<script src="script/constants.js?ver=16.12.376"></script>
<script src="script/service.js?ver=16.12.376"></script>
<script src="script/apply3.js?ver=16.12.376"></script>
<script type="text/javascript">
    // 照片的最大边压缩到该值
    var maxSize = 200 * 1024;
    var compress = function (res, fileSize, imgIndex) {
        var img = new Image();
        img.onload = function () {
            var ratio = (fileSize >= maxSize ? 0.2 : 1);
            var width = img.width;
            var height = img.height;
            var cvs = document.createElement('canvas');
            var ctx = cvs.getContext('2d');
            cvs.width = width;
            cvs.height = height;
            ctx.fillRect(0, 0, cvs.width, cvs.height);
            ctx.drawImage(img, 0, 0, width, height);
            var data = cvs.toDataURL('image/jpeg', ratio);
            V2UploadImages(data, imgIndex);
        };
        img.src = res;
    };
    //
    $(document).ready(function () {
        document.getElementById('img1').addEventListener('change', function () {
            var reader = new FileReader();
            reader.onload = function () {
                compress(this.result, this.result.length, 0);
            };
            reader.readAsDataURL(this.files[0]);
        }, false);
    });
</script>
